{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>ข้อมูลสินค้า</h2>
    <a href="{{ url_for('add_product') }}" class="btn btn-primary">
        <i class="fas fa-plus"></i> เพิ่มสินค้า
    </a>
</div>

<div class="table-responsive">
    <table class="table table-striped">
        <thead>
            <tr>
                <th>รูปภาพ</th>
                <th>รหัส</th>
                <th>ชื่อสินค้า</th>
                <th>บาร์โค้ด</th>
                <th>หน่วย</th>
                <th>สต๊อกขั้นต่ำ</th>
                <th>สต๊อกปัจจุบัน</th>
                <th>สถานะ</th>
                <th>จัดการ</th>
            </tr>
        </thead>
        <tbody>
            {% for product in products %}
            <tr>
                <td>
                    <img src="{{ url_for('product_image', product_id=product[0]) }}" 
                         alt="รูปสินค้า" class="product-image" 
                         onclick="showImageModal('{{ url_for('product_image', product_id=product[0]) }}', '{{ product[1] }}')"
                         style="cursor: pointer;"
                         onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0xNiAxNkMyMC40MTgzIDE2IDI0IDE5LjU4MTcgMjQgMjRDMjQgMjguNDE4MyAyMC40MTgzIDMyIDE2IDMyQzExLjU4MTcgMzIgOCAyOC40MTgzIDggMjRDOCAxOS41ODE3IDExLjU4MTcgMTYgMTYgMTZaIiBmaWxsPSIjOUNBM0FGIi8+Cjwvc3ZnPgo='">
                </td>
                <td>{{ product[0] }}</td>
                <td>{{ product[1] }}</td>
                <td>{{ product[2] }}</td>
                <td>{{ product[3] }}</td>
                <td>{{ product[4] }}</td>
                <td>{{ product[5] }}</td>
                <td>
                    {% if product[5] <= product[4] %}
                        <span class="badge bg-danger">สต๊อกต่ำ</span>
                    {% else %}
                        <span class="badge bg-success">ปกติ</span>
                    {% endif %}
                </td>
                <td>
                    <a href="{{ url_for('edit_product', product_id=product[0]) }}" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-edit"></i> แก้ไข
                    </a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="9" class="text-center text-muted">ไม่มีข้อมูลสินค้า</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div id="imageModal" class="modal fade">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="imageModalTitle">รูปภาพสินค้า</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center">
                <img id="modalImage" src="" alt="รูปภาพสินค้า" style="max-width: 100%; height: auto; border-radius: 8px;">
            </div>
        </div>
    </div>
</div>

<script>
function showImageModal(imageSrc, productName) {
    document.getElementById('modalImage').src = imageSrc;
    document.getElementById('imageModalTitle').textContent = 'รูปภาพสินค้า: ' + productName;
    new bootstrap.Modal(document.getElementById('imageModal')).show();
}
</script>
{% endblock %}