{% extends "base.html" %}

{% block content %}
<h2>แก้ไขข้อมูลสินค้า</h2>

<form enctype="multipart/form-data" method="POST">
    <div class="row">
        <div class="col-md-6">
            <div class="mb-3">
                <label class="form-label">ชื่อสินค้า</label>
                <input type="text" class="form-control" name="name" value="{{ product[1] }}" required>
            </div>
        </div>
        <div class="col-md-6">
            <div class="mb-3">
                <label class="form-label">บาร์โค้ด</label>
                <div class="input-group">
                    <input type="text" class="form-control" name="barcode" value="{{ product[2] }}" required>
                    <button type="button" class="btn btn-outline-secondary" onclick="startBarcodeScanner()">
                        <i class="fas fa-camera"></i> สแกน
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row">
        <div class="col-md-6">
            <div class="mb-3">
                <label class="form-label">หน่วย</label>
                <input type="text" class="form-control" name="unit" value="{{ product[3] }}" required>
            </div>
        </div>
        <div class="col-md-6">
            <div class="mb-3">
                <label class="form-label">สต๊อกขั้นต่ำ</label>
                <input type="number" class="form-control" name="min_stock" value="{{ product[4] }}" required>
            </div>
        </div>
    </div>
    
    <div class="mb-3">
        <label class="form-label">รายละเอียดสินค้า</label>
        <textarea class="form-control" name="description" rows="3" placeholder="รายละเอียดสินค้า">{{ product[8] or '' }}</textarea>
    </div>
    
    <div class="mb-3">
        <label class="form-label">รูปภาพสินค้า</label>
        {% if product[6] %}
        <div class="mb-2">
            <img src="{{ url_for('product_image', product_id=product[0]) }}" alt="รูปปัจจุบัน" style="width: 100px; height: 100px; object-fit: cover; border-radius: 8px;">
            <small class="text-muted d-block">รูปภาพปัจจุบัน</small>
        </div>
        {% endif %}
        <div class="input-group">
            <input type="file" class="form-control" name="image" accept="image/*">
            <button type="button" class="btn btn-outline-secondary" onclick="startCamera()">
                <i class="fas fa-camera"></i> ถ่ายรูป
            </button>
        </div>
        <div class="form-text">เลือกไฟล์หรือถ่ายรูปจากกล้อง</div>
        <img id="image-preview" style="display:none; width:100px; height:100px; object-fit:cover; border-radius:8px; margin-top:10px;">
    </div>
    
    <div class="mb-3">
        <button type="submit" class="btn btn-primary">บันทึกการแก้ไข</button>
        <a href="{{ url_for('products') }}" class="btn btn-secondary">ยกเลิก</a>
        <button type="button" class="btn btn-danger" onclick="confirmDelete()">
            <i class="fas fa-trash"></i> ลบสินค้า
        </button>
    </div>
</form>

<form id="deleteForm" method="POST" action="{{ url_for('delete_product', product_id=product[0]) }}" style="display:none;">
</form>

<script>
function confirmDelete() {
    if (confirm('คุณต้องการลบสินค้านี้หรือไม่?')) {
        document.getElementById('deleteForm').submit();
    }
}
</script>
</form>
<div id="scanner-modal" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">สแกนบาร์โค้ด</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center">
                <video id="scanner-video" width="100%" style="border-radius: 8px;"></video>
                <div class="mt-2">
                    <small class="text-muted">จัดกล้องให้เห็นบาร์โค้ดในกรอบสี่เหลี่ยม</small>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="camera-modal" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">ถ่ายรูปสินค้า</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center">
                <video id="camera-video" width="100%" autoplay></video>
                <div class="mt-3">
                    <button type="button" class="btn btn-primary" onclick="capturePhoto()">
                        <i class="fas fa-camera"></i> ถ่ายรูป
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}